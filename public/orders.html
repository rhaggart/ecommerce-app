<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>My Orders</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar is-primary">
        <div class="container">
            <div class="navbar-brand">
                <a class="navbar-item" href="index.html">
                    <span class="icon"><i class="fas fa-store"></i></span>
                    <span>Back to Shop</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <section class="section">
        <div class="container">
            <h1 class="title is-2 mb-5">
                <span class="icon-text">
                    <span class="icon"><i class="fas fa-receipt"></i></span>
                    <span>My Orders</span>
                </span>
            </h1>
            
            <div id="ordersList"></div>
        </div>
    </section>

    <script>
        async function loadOrders() {
            const email = prompt('Enter your email to view orders:');
            if (!email) {
                window.location.href = 'index.html';
                return;
            }

            try {
                const response = await fetch(`/api/orders/customer?email=${encodeURIComponent(email)}`);
                const orders = await response.json();
                
                const container = document.getElementById('ordersList');
                
                if (orders.length === 0) {
                    container.innerHTML = `
                        <div class="notification is-light has-text-centered">
                            <p><i class="fas fa-inbox fa-3x has-text-grey-light"></i></p>
                            <p class="mt-3 has-text-grey">No orders found for this email</p>
                            <a href="index.html" class="button is-primary mt-3">
                                <span class="icon"><i class="fas fa-shopping-bag"></i></span>
                                <span>Start Shopping</span>
                            </a>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = orders.map(order => {
                    const date = new Date(order.createdAt).toLocaleDateString();
                    const statusColors = {
                        pending: 'is-warning',
                        processing: 'is-info',
                        shipped: 'is-link',
                        delivered: 'is-success',
                        cancelled: 'is-danger'
                    };
                    const statusColor = statusColors[order.status] || 'is-light';
                    
                    return `
                        <div class="box mb-4">
                            <div class="is-flex is-justify-content-space-between is-align-items-center mb-3">
                                <div>
                                    <p class="title is-5 mb-1">Order #${order._id.substring(0, 8)}</p>
                                    <p class="subtitle is-6 has-text-grey">${date}</p>
                                </div>
                                <span class="tag is-large ${statusColor}">${order.status.toUpperCase()}</span>
                            </div>
                            
                            <div class="content">
                                <p class="has-text-weight-semibold">Items:</p>
                                <ul class="ml-4">
                                    ${order.items.map(item => `
                                        <li>${item.product?.name || 'Unknown'} (x${item.quantity}) - $${((item.product?.price || 0) * item.quantity).toFixed(2)}</li>
                                    `).join('')}
                                </ul>
                            </div>
                            
                            <div class="is-flex is-justify-content-space-between is-align-items-center mt-4 pt-3" style="border-top: 1px solid #dbdbdb;">
                                <span class="has-text-weight-bold is-size-5">Total:</span>
                                <span class="has-text-primary has-text-weight-bold is-size-4">$${order.total.toFixed(2)}</span>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (err) {
                console.error('Error:', err);
                document.getElementById('ordersList').innerHTML = `
                    <div class="notification is-danger">
                        Error loading orders. Please try again.
                    </div>
                `;
            }
        }

        loadOrders();
    </script>
</body>
</html>
