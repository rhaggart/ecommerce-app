<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>Admin Panel</h1>
        <nav>
            <a href="index.html">Shop</a>
            <a href="orders.html">Orders</a>
            <a href="#" onclick="logout()">Logout</a>
        </nav>
    </header>

    <main class="admin-panel">
        <section class="add-product">
            <h2>Add New Product</h2>
            <form id="productForm" enctype="multipart/form-data">
                <input type="text" id="name" placeholder="Product Name" required>
                <textarea id="description" placeholder="Description" required></textarea>
                <input type="number" id="price" placeholder="Price" step="0.01" required>
                <input type="number" id="quantity" placeholder="Quantity" required>
                <select id="category" required>
                    <option value="">Select Category</option>
                    <option value="Electronics">Electronics</option>
                    <option value="Clothing">Clothing</option>
                    <option value="Books">Books</option>
                    <option value="Home">Home</option>
                    <option value="Sports">Sports</option>
                    <option value="Other">Other</option>
                </select>
                <input type="file" id="image" accept="image/*" required>
                <button type="submit">Add Product</button>
            </form>
        </section>

        <section class="product-list">
            <h2>Manage Products</h2>
            <div id="adminProducts"></div>
        </section>
    </main>

    <script>
        const token = localStorage.getItem('token');
        if (!token) {
            window.location.href = 'login.html';
        }

        const form = document.getElementById('productForm');
        
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData();
            formData.append('name', document.getElementById('name').value);
            formData.append('description', document.getElementById('description').value);
            formData.append('price', document.getElementById('price').value);
            formData.append('quantity', document.getElementById('quantity').value);
            formData.append('category', document.getElementById('category').value);
            formData.append('image', document.getElementById('image').files[0]);

            try {
                const response = await fetch('/api/admin/products', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` },
                    body: formData
                });

                if (response.ok) {
                    alert('Product added successfully!');
                    form.reset();
                    loadAdminProducts();
                } else if (response.status === 401) {
                    alert('Session expired. Please login again.');
                    logout();
                } else {
                    alert('Error adding product');
                }
            } catch (err) {
                console.error('Error:', err);
                alert('Error adding product');
            }
        });

        async function loadAdminProducts() {
            try {
                const response = await fetch('/api/products');
                const products = await response.json();
                
                const container = document.getElementById('adminProducts');
                container.innerHTML = '';

                products.forEach(product => {
                    const productItem = document.createElement('div');
                    productItem.className = 'admin-product-item';
                    productItem.innerHTML = `
                        <img src="${product.image}" alt="${product.name}">
                        <div class="product-info">
                            <h3>${product.name}</h3>
                            <p>${product.description}</p>
                            <p>Category: ${product.category}</p>
                            <p>Price: $${product.price.toFixed(2)}</p>
                            <p>Quantity: ${product.quantity}</p>
                        </div>
                        <button onclick="deleteProduct('${product._id}')" class="delete-btn">Delete</button>
                    `;
                    container.appendChild(productItem);
                });
            } catch (err) {
                console.error('Error loading products:', err);
            }
        }

        async function deleteProduct(id) {
            if (confirm('Are you sure you want to delete this product?')) {
                try {
                    const response = await fetch(`/api/admin/products/${id}`, {
                        method: 'DELETE',
                        headers: { 'Authorization': `Bearer ${token}` }
                    });

                    if (response.ok) {
                        alert('Product deleted successfully!');
                        loadAdminProducts();
                    } else if (response.status === 401) {
                        alert('Session expired. Please login again.');
                        logout();
                    } else {
                        alert('Error deleting product');
                    }
                } catch (err) {
                    console.error('Error:', err);
                    alert('Error deleting product');
                }
            }
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = 'login.html';
        }

        loadAdminProducts();
    </script>
</body>
</html>